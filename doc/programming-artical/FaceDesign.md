# 概述

沉下心来认真做一次近几年工作的总结，围绕一个问题：如何搭建一个大数据场景下的用户数据平台？

一个用户数据平台应该具有如下能力：

1. 丰富的用户数据：这一点毋庸置疑是最基础的，多维度的用户标签数据是数据应用的基础；用户标签体系因应用而已，根据行业的不同，会有不同的设计。例如视频行业，可以去挖掘更多用户在观影方向的偏好，旅游行业，用户的户外兴趣会是更有帮助的数据。
2. 合格的监控管理系统：对外，需要给用户一个入口，来了解、申请和使用你的数据；对内，需要有完善的监控管理机制
3. 数据输出能力：包括用户数据怎样去赋能业务，给予决策人以正向的数据依据。这一点比较宽泛，数据输出可以有多种方式，举一些简单的例子：1）最直接的，是数据直接触达业务，常见的场景包括线上的用户定向，推荐场景中的基于用户数据的召回过滤策略等；2）各类DMP系统、分析系统、画像系统，都需要用户数据支持，给到系统的数据，往往是经过查询聚合的；3）离线的用户特征，用户行为分析等。

基于以上几点考虑，我们可以归纳为，一个用户数据平台，自底向上应该是包括三个主要层级的，分别是：数据、系统、服务。

# 背景

与小规模的用户角色分析不同，大数据下的用户分析方法是基于用户画像的。下图从技术方法、核心目标、数据形态、应用场景和应用特点分析了用户角色和用户画像的区别。在这里，我们所说的用户数据平台，也可以称之为用户画像平台。

![user-analysis](/img/user-analysis.jpeg)

简单的描述画像中的一条数据，那就是在一个特定的用户ID下，有多个维度的用户标签。如下图所示，我们通过用户标签数据来描述一个用户。在这里，用户是一个抽象的概念，一个用户，可以是一台手机设备，一台PC或者TV设备，也可以是从账号维度来描述的一个虚拟用户，用户标签数据的结构往往是复杂的，一个标签数据可能存在多个信息，例如权重等，图中只是标签值的一个简单表述。

![user-tag](/img/user-tag.jpeg)

# 设计

我们具体谈谈如何从零去搭建这样的一个平台。

## 数据层：用户数据的挖掘和存储

数据层主要描述的是如何进行用户数据的挖掘以及存储。

### 技术选型

#### 数据挖掘

待补充。

#### 数据存储

技术的选型是因应用而异的，不同的数据大小，数据结构，其所用到的数据解决方案都不一样。

在TB以上级别的数据量级下，我们会考虑大数据的解决方案。一个用户数据，多个维度标签，显然列式存储的数据库更适合于这样条数多但相对稀疏的数据。

底层离线数据的存储，这里更推荐的是HBase，回想一下HBase的特点和适用场景是什么？

> HBase是Google Bigtable的开源版本，是建立在HDFS之上，提供高可靠性、高性能、列存储、可伸缩、实时读写的数据库。

HBase 中的表一般有这样的特点：

- 大：一个表可以有上亿行，上百万列；（足以应对标签维度）
- 面向列：面向列(族)的存储和权限控制，列(族)独立检索；（单独的数据检索和权限控制）
- 稀疏：对于为空(null)的列，并不占用存储空间，因此，表可以设计的非常稀疏；（Bingo）
- 数据多版本：每个单元中的数据可以有多个版本，默认情况下版本号自动分配，是单元插入时的时间戳；（多数据版本，灵活的数据提供和使用方案）

无疑HBase的表特点是与用户数据的特点吻合的。

进一步的，我们想想HBase能提供什么样的能力。HBase的数据Get是亚秒级别的，无疑不适合高并发的数据获取，但HBase提供批量Scan的功能，适合一次写，多次读的场景，针对不同的服务应用，我们只需要将数据导入到其他不同的存储介质下即可；







用户数据挖掘

数据管理和监控

数据服务